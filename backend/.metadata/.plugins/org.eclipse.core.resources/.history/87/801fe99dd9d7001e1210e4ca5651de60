package io.github.RazzaNoonan.messagingservice;

import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import org.springframework.stereotype.Service;

import java.util.HashMap;
import java.util.Map;

@Service
public class FirebaseService {

    public void saveMessage(String chatId, String senderId, String receiverId, String message) {
        DatabaseReference databaseReference = FirebaseDatabase.getInstance().getReference();
        
        // Create a unique key for the message
        String key = databaseReference.child("messages").push().getKey();
        
        // Construct the message object to be stored
        Map<String, Object> messageDetails = new HashMap<>();
        messageDetails.put("senderId", senderId);
        messageDetails.put("receiverId", receiverId);
        messageDetails.put("message", message);
        messageDetails.put("timestamp", System.currentTimeMillis());
        
        // Save the message to Firebase
        if (key != null) {
            databaseReference.child("chats").child(chatId).child("messages").child(key).setValueAsync(messageDetails);
        }
    }
}
